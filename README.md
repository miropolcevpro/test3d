# WebAR визуализатор плитки (без 8thWall)

Проект — статическое веб‑приложение для GitHub Pages:
- сканирование пола (hit-test)
- калибровка/фиксация пола
- постановка точек строго по полу (по центральному лучу камеры)
- замыкание контура и заливка выбранной плиткой
- переключение раскладки (прямая / диагональ 45° / вразбежку)
- бордюр по контуру (вкл/выкл + ширина)
- depth-based окклюзия (best-effort, если поддерживается WebXR Depth API)
- локальный каталог плитки (tiles.json) + админка для редактирования и выгрузки JSON

## Важно про поддержку устройств
Полноценный режим разметки и заливки работает в **Chrome на Android** с поддержкой WebXR `immersive-ar` (обычно требуется ARCore).
На iOS (Safari) WebXR `immersive-ar` обычно недоступен. Для iOS понадобится отдельная реализация (native / 8thWall / Lightship) или другой подход.

## Локальный запуск
Статика должна открываться через http(s), иначе `fetch('tiles.json')` будет блокироваться.

Из папки проекта:
```bash
python -m http.server 8080
```
Откройте: http://localhost:8080

## Развёртывание на GitHub Pages
1) Залейте файлы в репозиторий.
2) В настройках репозитория включите GitHub Pages (ветка `main` / папка root).
3) Откройте URL GitHub Pages.

## Админка каталога
`/admin.html` — редактирование `tiles.json` и скачивание обновлённого файла.
На GitHub Pages запись на сервер невозможна, поэтому заменяйте файл в репозитории вручную.

## Заметки по окклюзии
Окклюзия включается, если устройство/браузер отдаёт depth (`frame.getDepthInformation(view)`).
Реализация — best-effort: сравнение глубины фрагмента заливки с глубиной сцены.



## Авто-обновление контента (галерея/шапка/иконки форм)

Чтобы при добавлении/замене изображений в архиве/репозитории контент автоматически подтягивался в приложении, используется генерация `shapes.json` из структуры папок.

### Правила по папкам
- Шапка формы (hero): `assets/forms/<shapeId>.webp|png|jpg` (или `assets/forms/<shapeId>_hero.*`)
- Иконка формы (thumb): `assets/forms/<shapeId>_thumb.*` (или `assets/forms/<shapeId>_icon.*`)
- Галерея формы: `assets/gallery/<shapeId>/*.(webp|png|jpg)` (например `1.webp`, `2.webp`…)

### Как работает
Скрипт `scripts/sync-content.mjs`:
- обновляет `hero/icon/gallery` в `shapes.json` по наличию файлов
- добавляет `?v=<mtime>` к путям, чтобы не залипал кеш на телефонах
- если `*_thumb` отсутствует — генерирует `assets/forms/<shapeId>_thumb.webp` из `hero` (в CI используется `sharp`)
- если появился новый `assets/gallery/<newId>/...` — создаёт новую форму в `shapes.json` (остальные поля можно отредактировать вручную)

### Локальный запуск
```bash
npm install
npm run sync:content
```

### GitHub Actions
Workflow `.github/workflows/sync-content.yml` запускает синхронизацию на каждый push в `assets/forms/**` или `assets/gallery/**`
и автоматически коммитит обновлённый `shapes.json` + сгенерированные thumbs.
