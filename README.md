# WebAR визуализатор плитки (без 8thWall)

Проект — статическое веб‑приложение для GitHub Pages:
- сканирование пола (hit-test)
- калибровка/фиксация пола
- постановка точек строго по полу (по центральному лучу камеры)
- замыкание контура и заливка выбранной плиткой
- переключение раскладки (прямая / диагональ 45° / вразбежку)
- бордюр по контуру (вкл/выкл + ширина)
- depth-based окклюзия (best-effort, если поддерживается WebXR Depth API)
- локальный каталог плитки (tiles.json) + админка для редактирования и выгрузки JSON

## Важно про поддержку устройств
Полноценный режим разметки и заливки работает в **Chrome на Android** с поддержкой WebXR `immersive-ar` (обычно требуется ARCore).
На iOS (Safari) WebXR `immersive-ar` обычно недоступен. Для iOS понадобится отдельная реализация (native / 8thWall / Lightship) или другой подход.

## Локальный запуск
Статика должна открываться через http(s), иначе `fetch('tiles.json')` будет блокироваться.

Из папки проекта:
```bash
python -m http.server 8080
```
Откройте: http://localhost:8080

## Развёртывание на GitHub Pages
1) Залейте файлы в репозиторий.
2) В настройках репозитория включите GitHub Pages (ветка `main` / папка root).
3) Откройте URL GitHub Pages.

## Админка каталога
`/admin.html` — редактирование `tiles.json` и скачивание обновлённого файла.
На GitHub Pages запись на сервер невозможна, поэтому заменяйте файл в репозитории вручную.

## Заметки по окклюзии
Окклюзия включается, если устройство/браузер отдаёт depth (`frame.getDepthInformation(view)`).
Реализация — best-effort: сравнение глубины фрагмента заливки с глубиной сцены.



## Палитры поверхностей (внешние текстуры)
Проект поддерживает загрузку палитр из Object Storage по URL:
- базовый URL задаётся в `SURFACE_PALETTE_BASE_URL` (см. `js/app.js`)
- формат: `palettes/<shapeId>.json`

### Пер-текстурные параметры `item.params`
Можно настраивать материал и цвет для каждой текстуры (без правок кода):

- `uvScale` или `repeatScale` (number или {x,y}): масштаб повторения UV (0.5 => текстура крупнее x2)
- `albedoGain` (number): усиление albedo (1.0 = нейтрально)
- `roughnessMult` (number): множитель roughness (1.0 = нейтрально)
- `specStrength` (number): сила бликов (1.0 = нейтрально)
- `exposureMult` (number): локальная экспозиция (0.75..1.05 обычно)
- `contrast` (number): локальный контраст (0.9..1.15 обычно)
- `saturation` (number): локальная насыщенность (0.85..1.05 обычно)
- `gamma` (number): локальная гамма (0.9..1.15 обычно)
- `colorBalance` (number | [r,g,b] | {r,g,b} | {x,y,z}): локальный баланс каналов (множитель). Пример: `[0.98, 1.0, 1.02]`
- `envDiffuseMult` (number): локальный множитель влияния env diffuse (0.5..1.2)
- `envSpecMult` (number): локальный множитель env spec (0.5..1.2)

Пример:
```json
"params": {
  "exposureMult": 0.82,
  "contrast": 1.08,
  "saturation": 0.92,
  "gamma": 1.05,
  "colorBalance": [0.98, 1.00, 1.01],
  "envDiffuseMult": 0.8,
  "envSpecMult": 0.7
}
```
